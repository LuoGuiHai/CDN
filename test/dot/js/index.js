"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var S={init:function(){var t=window.location.href,e=t.indexOf("?a=");S.Drawing.init(".canvas"),document.body.classList.add("body--ready"),-1!==e?S.UI.simulate(decodeURI(t).substring(e+3)):S.UI.simulate("Hello|welcome to|my blog|Beautiful day|Thank you|See you again|♥♥♥|★★|"),S.Drawing.loop(function(){S.Shape.render()})}};S.Drawing=function(){var e,i,n;return requestFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)},{init:function(t){e=document.querySelector(t),i=e.getContext("2d"),this.adjustCanvas(),window.addEventListener("resize",function(t){S.Drawing.adjustCanvas()})},loop:function(t){n=n||t,this.clearFrame(),n(),requestFrame.call(window,this.loop.bind(this))},adjustCanvas:function(){e.width=window.innerWidth,e.height=window.innerHeight},clearFrame:function(){i.clearRect(0,0,e.width,e.height)},getArea:function(){return{w:e.width,h:e.height}},drawCircle:function(t,e){i.fillStyle=e.render(),i.beginPath(),i.arc(t.x,t.y,t.z,0,2*Math.PI,!0),i.closePath(),i.fill()}}}(),S.UI=function(){var a,r,s,h=document.querySelector(".ui-input"),e=document.querySelector(".ui"),t=document.querySelector(".help"),i=document.querySelector(".commands"),c=document.querySelector(".overlay"),n=document.querySelector(".canvas"),o=!1,l=30,d=!0,u=[],f="#";function m(t){var e;return t.getHours()+":"+(e=(e=t.getMinutes())<10?"0"+e:e)}function w(t,e,i,n){clearInterval(a),t(r=n?i:1),(!i||!n&&r<i||n&&0<r)&&(a=setInterval(function(){t(r=n?r-1:r+1),(!n&&i&&r===i||n&&0===r)&&clearInterval(a)},e))}function p(t){clearInterval(a),u=[],s=null,t&&S.Shape.switchShape(S.ShapeBuilder.letter(""))}function v(a){var r,o;c.classList.remove("overlay--visible"),u="object"===_typeof(a)?a:u.concat(a.split("|")),h.value="",y(),w(function(t){var e,i;switch(o=u.shift(),r=(e=(e=o)&&e.split(" ")[0])&&e[0]===f&&e.substring(1),a=(i=o)&&i.split(" ")[1],r){case"countdown":w(function(t){0===t?0===u.length?S.Shape.switchShape(S.ShapeBuilder.letter("")):v(u):S.Shape.switchShape(S.ShapeBuilder.letter(t),!0)},1e3,a=0<(a=parseInt(a)||10)?a:10,!0);break;case"rectangle":a=(a=a&&a.split("x"))&&2===a.length?a:[l,l/2],S.Shape.switchShape(S.ShapeBuilder.rectangle(Math.min(l,parseInt(a[0])),Math.min(l,parseInt(a[1]))));break;case"circle":a=parseInt(a)||l,a=Math.min(a,l),S.Shape.switchShape(S.ShapeBuilder.circle(a));break;case"time":var n=m(new Date);0<u.length?S.Shape.switchShape(S.ShapeBuilder.letter(n)):w(function(){(n=m(new Date))!==s&&(s=n,S.Shape.switchShape(S.ShapeBuilder.letter(s)))},1e3);break;default:S.Shape.switchShape(S.ShapeBuilder.letter(o[0]===f?"What?":o))}},2e3,u.length)}function y(t){18<h.value.length?e.classList.add("ui--wide"):e.classList.remove("ui--wide"),d&&0<h.value.length?e.classList.add("ui--enter"):e.classList.remove("ui--enter")}return document.body.addEventListener("keydown",function(t){h.focus(),13===t.keyCode&&(d=!1,p(),v(h.value))}),h.addEventListener("input",y),h.addEventListener("change",y),h.addEventListener("focus",y),t.addEventListener("click",function(t){c.classList.toggle("overlay--visible"),c.classList.contains("overlay--visible")&&p(!0)}),i.addEventListener("click",function(t){var e,i,n;i=(e=t.target.classList.contains("commands-item")?t.target:t.target.parentNode.classList.contains("commands-item")?t.target.parentNode:t.target.parentNode.parentNode)&&e.querySelector(".commands-item-info"),n=e&&i.getAttribute("data-demo"),e&&i.getAttribute("data-url"),i&&(c.classList.remove("overlay--visible"),n&&(h.value=n,o?(p(),v(h.value)):h.focus()))}),n.addEventListener("click",function(t){c.classList.remove("overlay--visible")}),h.focus(),o&&document.body.classList.add("touch"),{simulate:function(t){v(t)}}}(),S.UI.Tabs=function(){document.querySelector(".tabs");var t=document.querySelector(".tabs-labels"),a=document.querySelectorAll(".tabs-label"),r=document.querySelectorAll(".tabs-panel");function o(t){a[t].classList.add("tabs-label--active"),r[t].classList.add("tabs-panel--active")}o(0),t.addEventListener("click",function(t){var e,i=t.target;if(i.classList.contains("tabs-label")){for(var n=0;n<a.length;n++)a[n].classList.remove("tabs-label--active"),r[n].classList.remove("tabs-panel--active"),i===a[n]&&(e=n);o(e)}})}(),S.Point=function(t){this.x=t.x,this.y=t.y,this.z=t.z,this.a=t.a,this.h=t.h},S.Color=function(t,e,i,n){this.r=t,this.g=e,this.b=i,this.a=n},S.Color.prototype={render:function(){return"rgba("+this.r+","+ +this.g+","+this.b+","+this.a+")"}},S.Dot=function(t,e){this.p=new S.Point({x:t,y:e,z:5,a:1,h:0}),this.e=.07,this.s=!0,this.c=new S.Color(255,255,255,this.p.a),this.t=this.clone(),this.q=[]},S.Dot.prototype={clone:function(){return new S.Point({x:this.x,y:this.y,z:this.z,a:this.a,h:this.h})},_draw:function(){this.c.a=this.p.a,S.Drawing.drawCircle(this.p,this.c)},_moveTowards:function(t){var e=this.distanceTo(t,!0),i=e[0],n=e[1],a=e[2],r=this.e*a;if(-1===this.p.h)return this.p.x=t.x,this.p.y=t.y,!0;if(1<a)this.p.x-=i/a*r,this.p.y-=n/a*r;else{if(!(0<this.p.h))return!0;this.p.h--}return!1},_update:function(){if(this._moveTowards(this.t)){var t=this.q.shift();t?(this.t.x=t.x||this.p.x,this.t.y=t.y||this.p.y,this.t.z=t.z||this.p.z,this.t.a=t.a||this.p.a,this.p.h=t.h||0):this.s?(this.p.x-=Math.sin(3.142*Math.random()),this.p.y-=Math.sin(3.142*Math.random())):this.move(new S.Point({x:this.p.x+50*Math.random()-25,y:this.p.y+50*Math.random()-25}))}d=this.p.a-this.t.a,this.p.a=Math.max(.1,this.p.a-.05*d),d=this.p.z-this.t.z,this.p.z=Math.max(1,this.p.z-.05*d)},distanceTo:function(t,e){var i=this.p.x-t.x,n=this.p.y-t.y,a=Math.sqrt(i*i+n*n);return e?[i,n,a]:a},move:function(t,e){(!e||e&&1<this.distanceTo(t))&&this.q.push(t)},render:function(){this._update(),this._draw()}},S.ShapeBuilder=function(){var s=13,a=document.createElement("canvas"),r=a.getContext("2d");function t(){a.width=Math.floor(window.innerWidth/s)*s,a.height=Math.floor(window.innerHeight/s)*s,r.fillStyle="red",r.textBaseline="middle",r.textAlign="center"}function o(){var t=r.getImageData(0,0,a.width,a.height).data;dots=[],x=0,y=0,fx=a.width,fy=a.height,w=0;for(var e=h=0;e<t.length;e+=4*s)0<t[e+3]&&(dots.push(new S.Point({x:x,y:y})),w=x>w?x:w,h=y>h?y:h,fx=x<fx?x:fx,fy=y<fy?y:fy),x+=s,x>=a.width&&(x=0,y+=s,e+=4*s*a.width);return{dots:dots,w:w+fx,h:h+fy}}function i(t){r.font="bold "+t+"px Avenir, Helvetica Neue, Helvetica, Arial, sans-serif"}return t(),window.addEventListener("resize",t),{imageFile:function(t,e){var i=new Image,n=S.Drawing.getArea();i.onload=function(){r.clearRect(0,0,a.width,a.height),r.drawImage(this,0,0,.6*n.h,.6*n.h),e(o())},i.onerror=function(){e(S.ShapeBuilder.letter("What?"))},i.src=t},circle:function(t){var e=Math.max(0,t)/2;return r.clearRect(0,0,a.width,a.height),r.beginPath(),r.arc(e*s,e*s,e*s,0,2*Math.PI,!1),r.fill(),r.closePath(),o()},letter:function(t){var e;return i(500),i(Math.min(500,a.width/r.measureText(t).width*.8*500,a.height/500*(e=t,!isNaN(parseFloat(e))&&isFinite(e)?1:.45)*500)),r.clearRect(0,0,a.width,a.height),r.fillText(t,a.width/2,a.height/2),o()},rectangle:function(t,e){for(var i=[],n=s*t,a=s*e,r=0;r<a;r+=s)for(var o=0;o<n;o+=s)i.push(new S.Point({x:o,y:r}));return{dots:i,w:n,h:a}}}}(),S.Shape=function(){var s=[],h=0,c=0,l=0,d=0;return{shuffleIdle:function(){for(var t=S.Drawing.getArea(),e=0;e<s.length;e++)s[e].s||s[e].move({x:Math.random()*t.w,y:Math.random()*t.h})},switchShape:function(t,e){var i,n,a=S.Drawing.getArea();if(h=t.w,c=t.h,n=S.Drawing.getArea(),l=n.w/2-h/2,d=n.h/2-c/2,t.dots.length>s.length){i=t.dots.length-s.length;for(var r=1;r<=i;r++)s.push(new S.Dot(a.w/2,a.h/2))}r=0;for(var o=0;0<t.dots.length;)o=Math.floor(Math.random()*t.dots.length),s[r].e=e?.25:s[r].s?.14:.11,s[r].s?s[r].move(new S.Point({z:20*Math.random()+10,a:Math.random(),h:18})):s[r].move(new S.Point({z:5*Math.random()+5,h:e?18:30})),s[r].s=!0,s[r].move(new S.Point({x:t.dots[o].x+l,y:t.dots[o].y+d,a:1,z:5,h:0})),t.dots=t.dots.slice(0,o).concat(t.dots.slice(o+1)),r++;for(o=r;o<s.length;o++)s[o].s&&(s[o].move(new S.Point({z:20*Math.random()+10,a:Math.random(),h:20})),s[o].s=!1,s[o].e=.04,s[o].move(new S.Point({x:Math.random()*a.w,y:Math.random()*a.h,a:.3,z:4*Math.random(),h:0})))},render:function(){for(var t=0;t<s.length;t++)s[t].render()}}}(),S.init();