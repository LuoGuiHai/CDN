"use strict";!function(){var n,i,e,o,a,s=window,c=!1,t=0,u=null,r=!1,d=$("#minimap"),l=d.find("#zoom-levels"),f=d.find("#volume").load(T),p=d.find("#about").load(T),g=d.find("#zoom-cursor"),m=0,v=function(t){return Math.pow(t,3)},h=$(window);h.click(function(t){var n=$(t.target).attr("id");r||"css-world"!==n&&"css-camera"!==n&&"glContainer"!==n?r=!1:w()}),h.resize(function(){if(!c)return u&&(T(),clearTimeout(u)),void(u=setTimeout(function(){0==firstTime&&h.trigger("resize")},500));var t=f.outerHeight()+p.outerHeight()+30,n=d.height()-t;l.height(n-2),d.hasClass("ready")||d.addClass("ready")}).bind("mouseup",z).bind("touchend",z).trigger("resize");s.initializeMinimap=function(){this.updateMinimap()},s.updateMinimap=function(){if(s.camera){var t,n=S(s.camera.position.target.z,1.1,4e4,0,1);m=S((t=n,Math.pow(t,1/3)),0,1,0,100),D(!0)}},s.setScrollPositionFromTouch=function(t){var n=t.pageY-l.offset().top;m=S(n,0,l.height(),0,100),D()},s.setMinimap=function(t){r=!!t},s.showSunButton=function(){a&&a.css({opacity:1,display:"inline"})};var C=s.hideSunButton=function(){a&&a.fadeOut()};l.bind("mousedown",function(t){var n=t.pageY-l.offset().top;m=S(n,0,l.height(),0,100),D(),h.bind("mousemove",y)}),l.bind("touchstart",function(t){var n=t.originalEvent.touches[0].pageY-l.offset().top;m=S(n,0,l.height(),0,100),D(),s.scrollbaring=!0}),p.click(function(t){t.preventDefault(),$detailContainer.addClass("about"),$("#css-container").css("display","none"),$.get("detail/about.html",function(t){$("#detailBody").html(t)}),$("#detailTitle").find("span").html("100,000 Stars"),$detailContainer.css({paddingTop:"60px"}),$detailContainer.fadeIn()});var b="0"===localStorage.getItem("sound");function y(t){var n=t.pageY-l.offset().top;m=S(n,0,l.height(),0,100),D()}function k(t){t.originalEvent.touches.length}function z(t){h.unbind("mousemove",y),h.unbind("touchmove",k)}function D(t){g.css({top:m+"%"}),t||function(){if(s.camera){var t=m/100;s.camera.position.target.z=S(v(t),0,1,1.1,4e4),s.camera.position.target.pz=s.camera.position.target.z}}()}function S(t,n,i,e,o){return Math.max(Math.min((s=e)+(t-(a=n))/(i-a)*(o-s),o),e);var a,s}function w(t){$("#detailContainer").fadeOut(),$("#css-container").css("display","block"),t&&(centerOnSun(),setTimeout(C,500),zoomOut(555))}function T(){t<3?t++:c||(c=!0)}$.get("https://cdn.jsdelivr.net/gh/LuoGuiHai/CDN/test/starmap/images/icons/sound-on.svg",function(t){n=$(t).find("svg").addClass("icon").css({display:b?"none":"block"}).click(function(t){t.preventDefault(),n.css({display:"none"}),muteSound(),i&&i.css({display:"inline-block"})}),f.append(n)}),$.get("https://cdn.jsdelivr.net/gh/LuoGuiHai/CDN/test/starmap/images/icons/sound-off.svg",function(t){i=$(t).find("svg").addClass("icon").css({display:b?"block":"none"}).click(function(t){t.preventDefault(),i.css({display:"none"}),unmuteSound(),n&&n.css({display:"inline-block"})}),f.append(i)}),$.get("https://cdn.jsdelivr.net/gh/LuoGuiHai/CDN/test/starmap/images/icons/big-tour.svg",function(t){o=$(t).find("svg").addClass("icon").attr("id","tour-button").tip("Take a tour.").click(function(t){t.preventDefault(),tour.start()}),$iconNav.append(o),$.get("https://cdn.jsdelivr.net/gh/LuoGuiHai/CDN/test/starmap/images/icons/heat-vision.svg",function(t){e=$(t).find("svg").addClass("icon").click(function(t){t.preventDefault(),toggleHeatVision()}).hover(function(t){o.trigger("mouseleave",[!0])},function(t){o.trigger("mouseenter")}).tip("Toggle Spectral Index."),$iconNav.append(e),$.get("https://cdn.jsdelivr.net/gh/LuoGuiHai/CDN/test/starmap/images/icons/center-sun.svg",function(t){a=$(t).find("svg").addClass("icon").tip("Center camera position to the Sun.").hover(function(t){o.trigger("mouseleave",[!0])},function(t){o.trigger("mouseenter")}).click(function(t){t.preventDefault(),w(!0)}).css({display:"none"}),$iconNav.append(a)})})})}();