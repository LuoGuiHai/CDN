"use strict";var galacticTexture0=THREE.ImageUtils.loadTexture("https://cdn.jsdelivr.net/gh/LuoGuiHai/CDN/test/starmap/images/galactic_sharp.png"),galacticTexture1=THREE.ImageUtils.loadTexture("https://cdn.jsdelivr.net/gh/LuoGuiHai/CDN/test/starmap/images/galactic_blur.png"),galacticUniforms={color:{type:"c",value:new THREE.Color(16777215)},texture0:{type:"t",value:galacticTexture0},texture1:{type:"t",value:galacticTexture1},idealDepth:{type:"f",value:1},blurPower:{type:"f",value:1},blurDivisor:{type:"f",value:2},sceneSize:{type:"f",value:120},cameraDistance:{type:"f",value:800},zoomSize:{type:"f",value:1},scale:{type:"f",value:1},heatVision:{type:"f",value:0}},galacticAttributes={size:{type:"f",value:[]},customColor:{type:"c",value:[]}};function generateGalaxy(){setLoadMessage("Generating the galaxy");for(var i=new THREE.ShaderMaterial({uniforms:galacticUniforms,attributes:galacticAttributes,vertexShader:shaderList.galacticstars.vertex,fragmentShader:shaderList.galacticstars.fragment,blending:THREE.AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0,sizeAttenuation:!0,opacity:0}),e=new THREE.Geometry,a=0,t=0,r=0,n=0;n<1e5;n++){var s=Math.cos(t)*r,o=0,l=Math.sin(t)*r,c=100-Math.sqrt(r);.3<Math.random()&&(c*=4*(1+Math.random())),s+=random(-c,c),l+=random(-c,c);var p=Math.sqrt(s*s+l*l),m=constrain(.02*Math.pow(constrain(90-.1*p,0,1e5),2),2,1e4)+120*Math.random();o+=random(-m,m),s*=20,o*=20,l*=20;var d=new THREE.Vector3(s,o,l);d.size=200+constrain(600/r,0,32e3),.99<Math.random()?d.size*=.9*Math.pow(1+Math.random(),3+3*Math.random()):.7<Math.random()&&(d.size*=1+.04*Math.pow(1+Math.random(),2)),0==n&&(d.size=1e5),e.vertices.push(d);var u=constrain(1-2e-8*Math.pow(r,3),.3,1)+random(-.1,.1),h=constrain(.7-1e-6*Math.pow(r,2),.41,1)+random(-.1,.1),g=constrain(.1+.004*r,.3,.6)+random(-.1,.1),v=new THREE.Color;v.r=u,v.g=h,v.b=g,e.colors.push(v),t+=2e-4,r+=.08,n%2e4==0&&(t=2*Math.PI/5*a,r=0,a++)}for(var E=new THREE.ParticleSystem(e,i),y=galacticAttributes.size.value,M=galacticAttributes.customColor.value,T=0;T<e.vertices.length;T++)y[T]=e.vertices[T].size,M[T]=e.colors[T];E.position.x=27e3,E.add(addLensFlare(0,0,0));var w=new THREE.MeshBasicMaterial({map:THREE.ImageUtils.loadTexture("https://cdn.jsdelivr.net/gh/LuoGuiHai/CDN/test/starmap/images/galactictop.png"),blending:THREE.AdditiveBlending,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide,transparent:!0}),f=new THREE.Mesh(new THREE.PlaneGeometry(15e4,15e4,30,30),w);f.rotation.x=Math.PI/2,f.material.map.anisotropy=maxAniso,E.add(f);var H=createDistanceMeasurement(new THREE.Vector3(0,0,-55e3),new THREE.Vector3(0,0,55e3));H.position.y=-1e3,H.visible=!1,attachLegacyMarker("Milky Way ~110,000 Light Years",H,1,{min:6e3,max:12e4}),E.add(H),H.rotation.x=Math.PI,E.measurement=H,window.toggleGalacticMeasurement=function(e){E.measurement.visible=null==e?!this.measurement.visible:e};var R=new THREE.MeshBasicMaterial({map:glowSpanTexture,blending:THREE.AdditiveBlending,transparent:!0,depthTest:!1,depthWrite:!1,wireframe:!0,opacity:1}),x=new THREE.IcosahedronGeometry(4e4,4),b=new THREE.Matrix4;b.scale(new THREE.Vector3(1,0,1)),x.applyMatrix(b);var z=new THREE.Mesh(x,R);return z.material.map.wrapS=THREE.RepeatWrapping,z.material.map.wrapT=THREE.RepeatWrapping,z.material.map.needsUpdate=!0,z.update=function(){pSystem.shaderMaterial.uniforms.heatVision.value},z.material.map.onUpdate=function(){this.offset.y-=1e-4,this.needsUpdate=!0},E.update=function(){galacticUniforms.zoomSize.value=1+1e4/camera.position.z;var e=window.innerWidth*window.innerHeight;if(galacticUniforms.scale.value=1.5*Math.sqrt(e),w.opacity=i.opacity,pSystem){var a=pSystem.shaderMaterial.uniforms.heatVision.value;0<a&&(w.opacity=1-a),galacticUniforms.heatVision.value=a,pDustSystem&&(pDustSystem.visible=!(0<a))}camera.position.z<2500?0<i.opacity&&(i.opacity-=.05):i.opacity<1&&(i.opacity+=.05),i.opacity<=0?(E.visible=!1,f.visible=!1):(E.visible=!0,f.visible=!0);var t=constrain(Math.pow(camera.position.z/8e4,3),0,1);t<1e-5&&(t=0),galacticCentering.position.set(0,0,0),galacticCentering.position.lerp(this.position.clone().negate(),t)},E.position.x=11404,E.position.y=14e3,E.position.z=1e4,E.rotation.x=2.775557,E.rotation.y=-.4,E.rotation.z=-1.099999,E}