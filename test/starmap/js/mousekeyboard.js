"use strict";var mouseX=0,mouseY=0,pmouseX=0,pmouseY=0,pressX=0,pressY=0,dragging=!1,scrollbaring=!1,rotateX=0,rotateY=0,rotateVX=0,rotateVY=0,rotateXMax=90*Math.PI/180,rotateTargetX=void 0,rotateTargetY=void 0,keyboard=new THREEx.KeyboardState,TOUCHMODES={NONE:0,SINGLE:1,DOUBLE:2},touchMode=TOUCHMODES.NONE,previousTouchDelta=0,touchDelta=0;function onDocumentMouseMove(e){touchMode==TOUCHMODES.NONE?(pmouseX=mouseX,pmouseY=mouseY,mouseX=e.clientX-.5*window.innerWidth,mouseY=e.clientY-.5*window.innerHeight,dragging&&(doCameraRotationFromInteraction(),window.setMinimap(dragging))):e.preventDefault()}function onDocumentMouseDown(e){dragging=!0,pressX=mouseX,pressY=mouseY,rotateTargetX=rotateTargetX=void 0,initialAutoRotate&&(initialAutoRotate=!1)}function onDocumentMouseUp(e){dragging=!1,histogramPressed=!1}function onClick(e){3<Math.abs(pressX-mouseX)||Math.abs(pressY-mouseY)}function onKeyDown(e){}function handleMWheel(e){camera.position.target.z+=e*camera.position.target.z*.01,camera.position.target.z=constrain(camera.position.target.z,.8,8e4),camera.position.target.pz=camera.position.target.z,camera.rotation.vx+=(2e-4*Math.random()-1e-4)*camera.position.z/1e3,camera.rotation.vy+=(2e-4*Math.random()-1e-4)*camera.position.z/1e3,window.updateMinimap&&window.updateMinimap(),initialAutoRotate&&(initialAutoRotate=!1)}function onMouseWheel(e){var o=0;e.wheelDelta?o=e.wheelDelta/120:e.detail&&(o=-e.detail/3),o&&handleMWheel(o),e.returnValue=!1}function onDocumentResize(e){}function determineTouchMode(e){e.touches.length<=0||2<e.touches.length?touchMode=TOUCHMODES.NONE:1!=e.touches.length?2!=e.touches.length||(touchMode=TOUCHMODES.DOUBLE):touchMode=TOUCHMODES.SINGLE}function equalizeTouchTracking(e){if(2==e.touches.length){var o=e.touches[0],t=e.touches[1];touchDelta=calculateTouchDistance(o,t),previousTouchDelta=touchDelta}if(!(e.touches.length<1)){var a=e.touches[0];pmouseX=mouseX=a.pageX-.5*window.innerWidth,pmouseX=mouseY=a.pageY-.5*window.innerHeight}}function touchStart(e){onDocumentMouseDown(e),determineTouchMode(e),equalizeTouchTracking(e),e.preventDefault()}function touchEnd(e){scrollbaring=!1,onDocumentMouseUp(e),determineTouchMode(e),equalizeTouchTracking(e)}function touchMove(e){if(scrollbaring){var o=e.touches[0];return setScrollPositionFromTouch(o),void e.preventDefault()}if(determineTouchMode(e),touchMode==TOUCHMODES.SINGLE){pmouseX=mouseX,pmouseY=mouseY;o=e.touches[0];mouseX=o.pageX-.5*window.innerWidth,mouseY=o.pageY-.5*window.innerHeight,dragging&&(doCameraRotationFromInteraction(),window.setMinimap(dragging))}else if(touchMode==TOUCHMODES.DOUBLE){var t=e.touches[0],a=e.touches[1];previousTouchDelta=touchDelta,handleMWheel(.25*-((touchDelta=calculateTouchDistance(t,a))-previousTouchDelta))}}function calculateTouchDistance(e,o){var t=e.pageX,a=e.pageY,n=o.pageX,i=o.pageY;return Math.sqrt(Math.pow(n-t,2)+Math.pow(i-a,2))}function doCameraRotationFromInteraction(){rotateVY+=(mouseX-pmouseX)/2*Math.PI/180*.2,rotateVX+=(mouseY-pmouseY)/2*Math.PI/180*.2,camera.rotation.vy+=5e-5*(mouseX-pmouseX)*camera.position.z/1e4,camera.rotation.vx+=5e-5*(mouseY-pmouseY)*camera.position.z/1e4}