"use strict";var GALAXY_TOUR=[{rx:-.18605511827781787,ry:-2.464222597755626,z:1.1,travelTime:5e3,restTime:4e3,message:"This is the Sun, our home star."},{rx:1.4395420537811414,ry:6.281532559509658,z:5.148607771018531,travelTime:4e3,restTime:3e3,message:"It would take 18 years for a jet airplane to fly to the sun.",callback:displaySunEarthDiagram},{rx:.8369933670834534,ry:1.837770087331788,z:30.937978822676058,travelTime:4e3,restTime:5e3,message:"The furthest man-made object, Voyager 1, is now almost 17 light hours away."},{rx:.6424544063335803,ry:-.0031800804774647718,z:198.23179619362583,travelTime:3e3,restTime:5e3,message:"This is the length of one light year, the distance that light can travel in a year."},{rx:.503337952515914,ry:-.9904961225532652,z:432.34847195438465,travelTime:4e3,restTime:8e3,message:"These are the stars closest to our solar system.<br>The nearest star system, Alpha Centauri, is 4.3 light years away."},{rx:.0019755752638865747,ry:.23341774437325485,z:1210.7034532510997,travelTime:4e3,restTime:5e3,message:"Named stars that astronomers have studied are highlighted here."},{rx:.5522785678088462,ry:1.324151395815386,z:1672.4214873346518,travelTime:5e3,restTime:5e3,message:"You're seeing the actual density and location of over 100,000 stars in this view."},{rx:-.4155179986306899,ry:2.5204046098483026,z:31782.290495394205,travelTime:5e3,restTime:5e3,message:"Blue, hotter burning stars reside closer to the galactic plane.",callback:highlightStarHeat},{rx:-.12216429754294249,ry:1.9989722678912,z:79999.99999999994,travelTime:5e3,restTime:5e3,message:"All of which are in the Milky Way... which has 200 to 400 billion stars in total.",callback:highlightMilkyWay},{rx:0,ry:0,z:1.1,travelTime:1e4,restTime:6e3,message:"Go forth and explore. Click, drag and zoom with your mouse."}],cinematic_width=75,Tour=function(t){this.current=0,this.states=t,this.touring=!1,this.timingBuffer=0,this.timers=[],this.domElement=$('<div id="theater" />').css({display:"none",position:"fixed",zIndex:9998,top:0,left:0,right:0,bottom:0,width:"100%",height:"100%"}).html('<div class="top-bar"></div><div class="bottom-bar"></div><div class="message" style="display: none;"></div>'),this.top=this.domElement.find(".top-bar"),this.bottom=this.domElement.find(".bottom-bar"),this.content=this.domElement.find(".message")};Tour.Easing=TWEEN.Easing.Sinusoidal.InOut,Tour.Duration=250,Tour.meta=$("#meta"),Tour.timeouts=[],Tour.prototype={getState:function(){var t,e={rx:camera.rotation.x,ry:camera.rotation.y,z:camera.position.z};for(var i in this.states){var r=this.states[i];if(e.z===r.z){t=r;break}}return t||e},start:function(){var t,e=this;0==e.current&&(t=$('<a href="#" />').html("Stop").click(function(t){t.preventDefault(),e.stop()})),e.current=0,e.touring=!1,e.timingBuffer=0,e.content.html(""),Tour.meta.fadeOut(),e.domElement.fadeOut();Tour.meta.find("p").html(t);return Tour.meta.css({marginLeft:-Tour.meta.width()/2+"px"}),this.show(function(){camera.__tour=this.touring=!0,this.current=0,this.next(!0)}),$detailContainer.fadeOut(),centerOn(new THREE.Vector3(0,0,0)),0<markers.length&&markers[0].select(),camera.position.target.x=0,toggleHeatVision(!1),this},stop:function(){return this.hide(),camera.__tour=!1,this.touring=!1,rotateX=rotating.rotation.x,rotateY=rotating.rotation.y,TWEEN.removeAll(),this},show:function(t){var e=this;return this.domElement.appendTo(document.body).fadeIn(function(){Tour.meta.fadeIn(),e.bottom.animate({marginBottom:0},Tour.Duration,"swing"),e.top.animate({marginTop:0},Tour.Duration,"swing",function(){t&&t.call(e)})}),this},hide:function(t){var e=this;return Tour.meta.fadeOut(),this.bottom.animate({marginBottom:-cinematic_width+"px"},Tour.Duration,"swing"),this.top.animate({marginTop:-cinematic_width+"px"},Tour.Duration,"swing",function(){e.domElement.fadeOut(),t&&t.call(e)}),this},showMessage:function(e,t,i){var r=this;r.show();r.timers.push(window.setTimeout(function(){r.content.html("<p><span>"+e+"</span></p>"),r.content.fadeIn();var t=$('<a href="#" />').html("Skip").click(function(t){t.preventDefault(),r.hide(),Tour.meta.fadeOut(),r.timingBuffer=0,r.clearTimers(),firstTime=!1,$(window).trigger("resize")});Tour.meta.find("p").html(t);Tour.meta.css({marginLeft:-Tour.meta.width()/2+"px"})},r.timingBuffer+1e3));return r.timingBuffer+=t+1e3,r.timers.push(window.setTimeout(function(){r.content.fadeOut(function(){i&&i()})},r.timingBuffer)),this},clearTimers:function(){for(var t in this.timers){var e=this.timers[t];window.clearTimeout(e)}},endMessages:function(){var t=this,e=window.setTimeout(function(){t.hide()},t.timingBuffer+1e3);t.timers.push(e)},next:function(t){var e=this,i=this.state=this.states[this.current];return _.each(Tour.timeouts,clearTimeout),this.current,this.states.length,i?(this.current++,i.callback?this.arrivalCallback=i.callback:this.arrivalCallback=void 0,"none"!=this.content.css("display")?this.content.fadeOut(function(){e.content.html("<p><span>"+i.message+"</span></p>")}):this.content.html("<p><span>"+i.message+"</span></p>"),this.rotating_tween=new TWEEN.Tween(rotating.rotation).to({x:i.rx,y:i.ry},i.travelTime).easing(Tour.Easing).start(),this.camera_tween=new TWEEN.Tween(camera.position).to({z:i.z},i.travelTime).easing(Tour.Easing).onComplete(function(){camera.position.target.z=camera.position.z,e.arrivalCallback&&e.arrivalCallback(),e.content.fadeIn(function(){Tour.timeouts.push(setTimeout(function(){t&&e.next(!0)},i.restTime))})}).start()):this.stop(),this},previous:function(t){return this}};var getTourState=function(t,e,i){return JSON.stringify({rx:rotating.rotation.x,ry:rotating.rotation.y,z:camera.position.z,travelTime:t||1500,restTime:e||3e3,message:i||""})};